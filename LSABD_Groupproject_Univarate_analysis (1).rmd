---
title: "LSABD_Groupproject_univarate_analysis"
output: html_document
date: "2025-11-26"
---

```{r}
# import libraries
library(tidyverse)
library(ComplexHeatmap)
library(stats)

# Import data sets
combined_dataset <- read.csv("combined_dataset.csv")
features_somameres <- read.csv("feature_meta.csv")

# Heads of both combined_datasets
head(combined_dataset)
head(features_somameres)

# Split the combined_dataset in protein expression levels and meta data
combined_dataset_protein <-combined_dataset[,1:7241]
combined_dataset_features <-combined_dataset[,7242:7258]

# Columns: sex, ethnicity, ... converted to factors
clinical_data <- c("ethnicity", "sex", "ihd", "previous_vte","copd", "diabetes", "smoking", "cause_eskd",
  "WHO_severity", "WHO_temp_severity", "case_control","radiology_evidence_covid", "fatal_disease")
combined_dataset_features[clinical_data] <- lapply((combined_dataset_features[clinical_data]),factor)
str(combined_dataset_features)

# Log transforming and scale data 
proteins_log <- log(combined_dataset_protein[,2:7241])
protein_scaled <- as.data.frame(scale(proteins_log))
proteins_scaled_ids <- protein_scaled %>% mutate(X = combined_dataset_protein$X) %>% arrange()
```
```{r}
# Visualisation from the distribution of WHO_temp_severety
combined_dataset_features %>% 
  ggplot(aes(x = WHO_temp_severity)) + 
  geom_bar(fill = "steelblue") + 
  theme_minimal() +
  labs(title = "Distribution of WHO_temp_severity", x = "WHO_temp_severity", y = "Count")
```
```{r}
# Boxplot from a selection of proteins
protein_scaled_ids %>% select(X,[,1:10]) %>%pivot_longer(names_to = "prots", values_to = "abundances")
  ggplot()+
  geom_boxplot()

# Variances of proteins
cv <- function (x) {sd(x, na.rm = TRUE) / mean(x, na.rm = TRUE) * 100}

variatie_per_eiwit <- sapply(protein_scaled, cv)

top_cv <- sort(variatie_per_eiwit, decreasing = TRUE)
top_candidates <- data.frame(protein = names (top_cv), CV_percent = round(top_cv, 2))

# Bekijk het resultaat
print(top_candidates)

combined_dataset_protein$zg16
```

```{r}
# Visualise abundance of TIMM13 per stage of severity (WHO_temp_severity) by a boxplot
stage <- combined_dataset_features$WHO_temp_severity

ggplot (mapping=aes (x=stage, y=combined_dataset_protein$TIMM13)) +
  geom_boxplot () +
  geom_point ( position = "jitter", color="grey")
```
# Hypotheses
Null hypothesis (H₀): TIMM13 expression levels are the same across all severity groups.
Alternative hypothesis (H₁): At least one severity group has different TIMM13 expression levels.

# anova test-> statistical test to check that the protein expression levels in different stages of severity is significantly different ? 
Dependent variable (DV): Protein expression levels of TIMM13 (continuous data).
Independent variable (IV): Severity groups (categorical, e.g., mild, moderate, severe). -> uitleg wrm 

```{r}
# For an ANOVA test, we need to check the normaility within the group

combined_dataset %>%
  ggplot(aes(sample = TIMM13)) +
  geom_qq() + 
  geom_qq_line() +
  facet_wrap(~WHO_temp_severity)

```
Interpretatie normaliteit:
QQplots van data met outliers inbegrepen -> Data voor elke groep met uitzondering van "Negative" zijn normaal verdeeld. Vermoedelijk als de outliers verwijderd worden zal dit opgelost zijn.

# ANOVA test
```{r}
# One way ANOVA
anova_TIMM13 <- aov(TIMM13~WHO_temp_severity, data = combined_dataset)
summary(anova_TIMM13)
```
Intrpretation ANOVA:
significant difference -> p-value < 0,05 (0.0167)

We will perform a post-hoc analysis to identify which groups differe from each other

```{r}
posthoc_TIMM13 <- TukeyHSD(anova_TIMM13, conf.level = 0.95)
posthoc_TIMM13
```

```{r}
plot(posthoc_TIMM13, las = 1)
```
Interpretatie post-hoc analyse:
er zijn geen significante verschillen tussen de groepen
