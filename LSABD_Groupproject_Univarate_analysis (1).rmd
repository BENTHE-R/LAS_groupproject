---
title: "LSABD_Groupproject_univarate_analysis"
output: html_document
date: "2025-11-26"
---

```{r}
# import libraries
library(tidyverse)
library(ComplexHeatmap)
library(stats)

# Import data sets
combined_dataset <- read.csv("combined_dataset.csv")
features_somameres <- read.csv("feature_meta.csv")

# Heads of both combined_datasets
head(combined_dataset)
head(features_somameres)

# Split the combined_dataset in protein expression levels and meta data
combined_dataset_protein <-combined_dataset[,1:7241]
combined_dataset_features <-combined_dataset[,7242:7258]

# Columns: sex, ethnicity, ... converted to factors
clinical_data <- c("ethnicity", "sex", "ihd", "previous_vte","copd", "diabetes", "smoking", "cause_eskd",
  "WHO_severity", "WHO_temp_severity", "case_control","radiology_evidence_covid", "fatal_disease")
combined_dataset_features[clinical_data] <- lapply((combined_dataset_features[clinical_data]),factor)
str(combined_dataset_features)

# Log transforming and scale data 
proteins_log <- log(combined_dataset_protein[,2:7241])
protein_scaled <- as.data.frame(scale(proteins_log))
proteins_scaled_ids <- protein_scaled %>% mutate(X = combined_dataset_protein$X) %>% relocate(X, .before = 1)

# Boxplot from a selection of proteins after scaling
proteins_scaled_ids[,1:10] %>% pivot_longer(!X, names_to = "prots", values_to = "abundances") %>%
  ggplot(aes(x= prots, y = abundances))+
  geom_boxplot()

proteins_scaled_ids %>% pivot_longer(!X, names_to = "prots", values_to = "abundances") %>%
  group_by(prots) %>%
  summarise(sd(abundances))
```
```{r}
# Visualisation from the distribution of WHO_temp_severety
combined_dataset_features %>% 
  ggplot(aes(x = WHO_temp_severity)) + 
  geom_bar(fill = "steelblue") + 
  theme_minimal() +
  labs(title = "Distribution of WHO_temp_severity", x = "WHO_temp_severity", y = "Count")
```
```{r}
# Variances of proteins
cv <- function (x) {sd(x, na.rm = TRUE) / mean(x, na.rm = TRUE) * 100}

IQR_per_protein <- proteins_scaled_ids %>% pivot_longer(!X, names_to = "prots", values_to = "abundances") %>%
  group_by(prots) %>%
  summarise(IQR = IQR(abundances)) %>%
  arrange(desc(IQR))

# The top 10 proteins with the highest inter queartile range
IQR_per_protein[1:10,]

```
Based on the IQR we will conclude that MX1 has the highest variable expression among all samples.
```{r}
# Make a dataframe with only the MX1 expression pre sample and the coresponding WHO_temp_severety
df_univariate_analysis <- proteins_scaled_ids %>% select(X, MX1) %>% mutate(WHO_temp_severity = combined_dataset_features$WHO_temp_severity)

# Visualise abundance of MX1 per stage of severity (WHO_temp_severity) by a boxplot
df_univariate_analysis %>% ggplot (mapping = aes (x= WHO_temp_severity, y= MX1)) +
  geom_boxplot () +
  geom_point ( position = "jitter", color="grey")
```
# Hypotheses
Null hypothesis (H₀): MX1 expression levels are the same across all severity groups.
Alternative hypothesis (H₁): At least one severity group has different MX1 expression levels.

# anova test-> statistical test to check that the protein expression levels in different stages of severity is significantly different ? 
Dependent variable (DV): Protein expression levels of MX1 (continuous data).
Independent variable (IV): Severity groups (categorical, e.g., mild, moderate, severe). -> uitleg wrm 

```{r}
# For an ANOVA test, we need to check the normaility within the group
df_univariate_analysis %>%
  ggplot(aes(sample = MX1) +
  geom_qq() + 
  geom_qq_line() 
  #facet_wrap(~WHO_temp_severity)

```
Interpretatie normaliteit:
QQplots van data met outliers inbegrepen -> Data voor elke groep met uitzondering van "Negative" zijn normaal verdeeld. Vermoedelijk als de outliers verwijderd worden zal dit opgelost zijn.

# ANOVA test
```{r}
# One way ANOVA
anova_MX1 <- aov(MX1~WHO_temp_severity, data = df_univariate_analysis)
summary(anova_MX1)
```
Intrpretation ANOVA:
significant difference -> p-value < 0,05 (0.0167)

We will perform a post-hoc analysis to identify which groups differe from each other

```{r}
posthoc_MX1 <- TukeyHSD(anova_MX1, conf.level = 0.95)
posthoc_MX1
```

```{r}
plot(posthoc_MX1, las = 1)
```
Interpretatie post-hoc analyse:
er zijn geen significante verschillen tussen de groepen
